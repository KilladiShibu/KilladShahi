<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sura Games - Shop</title>
<style>
	html, body { height: 100%; margin: 0; }
	body {
		background: url('Background.jpg') no-repeat center center fixed;
		background-size: cover;
		font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
		color: #0f172a;
	}
	.topbar {
		position: fixed;
		top: 12px;
		right: 12px;
		display: flex;
		align-items: center;
		gap: 8px;
		background: rgba(255,255,255,.9);
		border: 1px solid rgba(15,23,42,.12);
		border-radius: 999px;
		padding: 8px 12px;
		box-shadow: 0 8px 24px rgba(0,0,0,.12);
	}
	.coin { width: 22px; height: 22px; border-radius: 50%; background: radial-gradient(circle at 30% 30%, #fff59d, #fbbf24 45%, #d97706 85%); box-shadow: inset 0 0 0 2px rgba(0,0,0,.08); }
	.wrapper { min-height: 100%; display: flex; align-items: center; justify-content: center; padding: 24px 16px; }
	.card {
		width: 100%;
		max-width: 920px;
		background: rgba(255,255,255,.92);
		border-radius: 16px;
		border: 1px solid rgba(15,23,42,.12);
		box-shadow: 0 12px 40px rgba(0,0,0,.18);
		padding: 20px;
	}
	h1 { margin: 0 0 12px; }
	.grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 16px; }
	@media (max-width: 480px) {
		.grid { grid-template-columns: repeat(2, 1fr); gap: 12px; }
		.card { padding: 16px; }
		.topbar {
			top: 8px;
			right: 8px;
			padding: 6px 10px;
			font-size: clamp(12px, 3.5vw, 14px);
			gap: 6px;
		}
		.coin {
			width: clamp(16px, 4vw, 18px);
			height: clamp(16px, 4vw, 18px);
			flex-shrink: 0;
		}
		#coinCount {
			font-size: clamp(12px, 3.5vw, 14px) !important;
			white-space: nowrap;
		}
		h1 { font-size: 24px; }
		.btn { padding: 8px 10px; font-size: 14px; }
	}
	.tile { background:#f1f5f9; border:2px solid #cbd5e1; border-radius:12px; overflow:hidden; display:flex; flex-direction:column; }
	.thumb { width: 100%; aspect-ratio: 1/1; object-fit: cover; display:block; }
	.meta { padding: 10px; display:flex; align-items:center; justify-content:space-between; gap:8px; }
	.price { font-weight:800; display:flex; align-items:center; gap:6px; }
	.price .coin { width:16px; height:16px; }
	.btn {
		appearance:none; padding:8px 12px; font-weight:800; border-radius:10px; border:none; cursor:pointer;
		background:#38bdf8; color:#0b1220; box-shadow: 0 10px 30px rgba(56,189,248,.35), inset 0 0 0 2px rgba(255,255,255,.25);
	}
	.btn[disabled] { opacity:.6; cursor:not-allowed; }
	.actions { display:flex; justify-content:space-between; align-items:center; margin-top:10px; }
	.link { color:#0ea5e9; text-decoration:none; }
	.link:hover { text-decoration:underline; }
	.note { margin-top:10px; color:#065f46; font-weight:700; }
</style>
</head>
<body>
	<div class="topbar" title="Your coins">
		<div class="coin"></div>
		<span id="coinCount" style="font-weight:800;">0</span>
	</div>

	<div class="wrapper">
		<div class="card">
			<h1>Shop</h1>
			<p style="margin-top:0;color:#475569;">Buy skins with your coins. Purchased skins become available in Skins.</p>
			<div class="grid" id="shopGrid">
				<!-- Items will be rendered by script -->
			</div>
			<div class="actions">
				<a class="link" href="home.html">Back to Home</a>
				<a class="link" href="skin.html">Go to Skins</a>
			</div>
			<div id="status" class="note"></div>
		</div>
	</div>

	<script>
	(function(){
		function userKey(key) {
			var u = '';
			try { u = localStorage.getItem('sg_username') || 'guest'; } catch(e){ u = 'guest'; }
			return 'sg_u:' + u + ':' + key;
		}
		function getUserNum(key, def){ try { return parseInt(localStorage.getItem(userKey(key))||String(def||0),10) || (def||0); } catch(e){ return def||0; } }
		function setUserNum(key, val){ try { localStorage.setItem(userKey(key), String(val)); } catch(e){} }
		function getUserJson(key, def){ try { return JSON.parse(localStorage.getItem(userKey(key))||def); } catch(e){ try { return JSON.parse(def); } catch(e2){ return []; } } }
		function setUserJson(key, val){ try { localStorage.setItem(userKey(key), JSON.stringify(val)); } catch(e){} }
		// migrate global -> user scope once
		(function migrate(){
			try {
				if (localStorage.getItem(userKey('migrated')) === '1') return;
				var map = { coins:'sg_coins', owned_skins:'sg_owned_skins', selected_skin:'sg_selected_skin' };
				Object.keys(map).forEach(function(k){
					var v = localStorage.getItem(map[k]);
					if (v != null) localStorage.setItem(userKey(k), v);
				});
				localStorage.setItem(userKey('migrated'),'1');
			} catch(e) {}
		})();

		var ITEMS = [
			{ id: 'Mandhi', name: 'Mandhi', cost: 0, img: 'mandhi.png', alwaysOwned: true },
			{ id: 'ρg', name: 'ρg', cost: 20, img: 'ρg.png' },
			{ id: 'skin3', name: 'Skin 3', cost: 15, img: 'skin3.png' },
			{ id: 'skin4', name: 'Skin 4', cost: 20, img: 'skin4.png' },
			{ id: 'skin5', name: 'Skin 5', cost: 25, img: 'skin5.png' },
			{ id: 'skin6', name: 'Skin 6', cost: 30, img: 'skin6.png' }
		];

		function getCoins(){ return getUserNum('coins', 0); }
		function setCoins(v){ setUserNum('coins', v); }
		function getOwned(){ return getUserJson('owned_skins', '[]'); }
		function setOwned(list){ setUserJson('owned_skins', list); }
		function isOwned(id){
			if (id === 'Mandhi') return true;
			var owned = getOwned();
			for (var i=0;i<owned.length;i++) if (owned[i] === id) return true;
			return false;
		}

		function render(){
			var coinEl = document.getElementById('coinCount');
			if (coinEl) coinEl.textContent = String(getCoins());
			var grid = document.getElementById('shopGrid');
			grid.innerHTML = '';
			ITEMS.forEach(function(item){
				var owned = isOwned(item.id);
				var div = document.createElement('div');
				div.className = 'tile';
				div.innerHTML =
					'<img class="thumb" src="'+item.img+'" alt="'+item.name+'">' +
					'<div class="meta">' +
					'  <div class="price"><span>'+item.name+'</span></div>' +
					(owned ? '<button class="btn" disabled>Owned</button>' :
						('<button class="btn buyBtn" data-id="'+item.id+'" data-cost="'+item.cost+'">Buy ('+item.cost+')' +
							' </button>')) +
					'</div>';
				grid.appendChild(div);
			});
		}

		function buy(id, cost){
			if (id === 'Mandi') return;
			var coins = getCoins();
			if (coins < cost) {
				var s = document.getElementById('status');
				if (s) { s.style.color = '#b91c1c'; s.textContent = 'Insufficient coin.'; }
				return;
			}
			var owned = getOwned();
			for (var i=0;i<owned.length;i++) if (owned[i] === id) return;
			owned.push(id);
			setOwned(owned);
			setCoins(coins - cost);
			var s2 = document.getElementById('status');
			if (s2) { s2.style.color = '#065f46'; s2.textContent = 'Purchased '+id+'! Available in Skins.'; }
			render();
		}

		document.addEventListener('click', function(e){
			var btn = e.target.closest('.buyBtn');
			if (!btn) return;
			var id = btn.getAttribute('data-id');
			var cost = parseInt(btn.getAttribute('data-cost')||'0', 10);
			buy(id, cost);
		});

		// Ensure default ownership of Mandhi and migrate old names/ids if needed
		try {
			var sel = localStorage.getItem(userKey('selected_skin'));
			if (!sel) localStorage.setItem(userKey('selected_skin'),'Mandhi');
			if (sel === 'Mandi') localStorage.setItem(userKey('selected_skin'),'Mandhi');
			if (sel === 'skin2') localStorage.setItem(userKey('selected_skin'),'ρg');

			var owned = getUserJson('owned_skins','[]');
			var changed = false;
			for (var i=0;i<owned.length;i++) {
				if (owned[i] === 'skin2') { owned[i] = 'ρg'; changed = true; }
			}
			if (changed) setUserJson('owned_skins', owned);
		} catch(e){}

		render();
	})();
	</script>
</body>
</html>


